<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/xdoc/new.xml at 05 December 2023
 | Rendered using Apache Maven Fluido Skin 1.10.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <meta name="author" content="The MyBatis Team" />
    <title>MyBatis Migrations &#x2013; MyBatis Migrations | Migrate > new</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.10.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.10.0.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h2>MyBatis Migrations</h2>
</div>
</div>
          <div class="pull-right"><a href="../" id="bannerRight" title="MyBatis logo"><img src="../images/mybatis-logo.png"  alt="MyBatis logo"/></a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 05 December 2023<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 3.3.11</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Migrations</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="installation.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li><a href="migrate.html" title="The 'migrate' Command"><span class="icon-chevron-down"></span>The 'migrate' Command</a>
     <ul class="nav nav-list">
      <li><a href="init.html" title="init"><span class="none"></span>init</a></li>
      <li><a href="bootstrap.html" title="bootstrap"><span class="none"></span>bootstrap</a></li>
      <li class="active"><a href="#"><span class="none"></span>new</a></li>
      <li><a href="status.html" title="status"><span class="none"></span>status</a></li>
      <li><a href="updown.html" title="up, down"><span class="none"></span>up, down</a></li>
      <li><a href="version.html" title="version"><span class="none"></span>version</a></li>
      <li><a href="pending.html" title="pending"><span class="none"></span>pending</a></li>
      <li><a href="redo.html" title="redo"><span class="none"></span>redo</a></li>
      <li><a href="script.html" title="script"><span class="none"></span>script</a></li>
      <li><a href="shortcuts.html" title="Command Shortcuts"><span class="none"></span>Command Shortcuts</a></li>
      <li><a href="custom-loader.html" title="Custom MigrationLoader"><span class="none"></span>Custom MigrationLoader</a></li>
     </ul></li>
    <li><a href="hooks.html" title="Migration Hooks"><span class="none"></span>Migration Hooks</a></li>
    <li><a href="runtime-migration.html" title="Runtime Schema Migration"><span class="none"></span>Runtime Schema Migration</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >


  
    <section>
<h2><a name="The_.27new.27_command"></a>The 'new' command</h2>
      
<p>Now that you&#x2019;ve initialized your repository and bootstrapped your existing database schema, you&#x2019;re ready to
      start leveraging the power of MyBatis Migrations!</p>

      
<p>MyBatis Migrations are simple SQL script files (*.sql) that live in the <code>scripts</code> directory and
      follow a very strict convention. Since this convention is so important, we don&#x2019;t want to leave it up to humans to
      try to get it right every time... so we let automation do what it does best, and keep things consistent.</p>

      
<p>The <code>new</code> command generates the skeleton of a migration script that you can then simply fill in.
      The command is simply run as follows:</p>

      
<div class="source"><pre class="prettyprint">/home/cbegin/testdb$ migrate new &quot;create blog table&quot;</pre></div>

      
<p>The parameter that the new command takes is a comment describing the migration that you're
        creating. You don&#x2019;t need quotes around it, but it helps keep the command readable.</p>

      
<p>When the command is run, it will create a file named something like the following:</p>

      
<div class="source"><pre class="prettyprint">20090807221754_create_blog_table.sql</pre></div>

      
<p>This format is very important (which is why it&#x2019;s generated). The number at the beginning plays three roles.
      First, it&#x2019;s a <i>practically unique</i> identifier, meaning it&#x2019;s highly unlikely that two people will generate the
      same one at the same time (it&#x2019;s not a big deal to resolve if it does happen). Second, it&#x2019;s a timestamp, indicating
      when the migration was created. Third, it is an ordinal index, formatted in a way that will keep the migrations
      sorted in the order in which they were created. The remainder of the filename is the comment you specified in the
      parameter. Finally, the suffix is .sql, indicating the file type that most editors will recognize.</p>

      
<p>Since version 3.2.1, you can change the default timestamp-based file prefix to number sequence by specifying <code>--idpattern</code> option. Assuming that the prefix of the latest existing script is '002', with the following command:</p>

      
<div class="source"><pre class="prettyprint">/home/cbegin/testdb$ migrate --idpattern=000 new &quot;create blog table&quot;</pre></div>

      
<p>the name of the generated file will be:</p>

      
<div class="source"><pre class="prettyprint">003_create_blog_table.sql</pre></div>

      
<p>Instead of specifying the pattern as a command line argument, you can set it in the configuration file <code>$MIGRATIONS_HOME/migration.properties</code> as follows.</p>

      
<div class="source"><pre class="prettyprint"># Example of migration.properties
idpattern=000</pre></div>

      
<p>The contents of the migration script also follows a specific and required pattern.
      Here's the contents of the file we just generated:</p>

      
<div class="source"><pre class="prettyprint">-- // create blog table
-- Migration SQL that makes the change goes here.

-- //@UNDO
-- SQL to undo the change goes here.</pre></div>

      
<p>Notice that your comment once again appears at the top of the file.
      You can add more comments beneath it and throughout the script if you like.</p>

      
<p>The section immediately following that comment is where you would put your DDL commands to create the blog table.</p>

      
<p>Then notice the </p>
<div class="source"><pre class="prettyprint">-- //@UNDO</pre></div> section. This section demarcates the script file sections, splitting
      it into two distinct parts. Only the commands above the undo section will be executed when <i>upgrading</i> a database.
      Everything beneath the undo section will be run when <i>downgrading</i> the database. Both sections are kept in
      the same file for simplicity and clarity. The following is a filled in script:

      
<div class="source"><pre class="prettyprint">-- // create blog table
CREATE TABLE BLOG (
  ID INT,
  NAME VARCHAR(255),
  PRIMARY KEY(ID)
);

-- //@UNDO
DROP TABLE BLOG;</pre></div>

      
<p>Notice that the commands are <b>terminated by a colon</b>. This is also important, and you will receive a
      warning and likely a failure if you don't terminate the SQL statements with a colon.</p>

      
<p>Optionally, you can configure your own template to be consumed by the 'new' command. Configuration requires a
      file named migration.properties (in <code>$MIGRATIONS_HOME</code>). This file will contain the location of your template.</p>

      
<div class="source"><pre class="prettyprint"># Example of migration.properties

new_command.template=templates/new_template_migration.sql</pre></div>

      
<p>Alternatively you can manually specify the location of your template as such:</p>

      
<div class="source"><pre class="prettyprint">migrate new --template=&lt;path to template&gt; &quot;your description&quot;</pre></div>

      
<p>If neither of these are used, or valid, the default template shown on the previous page will be used.</p>

      
<p>So how do we run this script? Well, first it&#x2019;s probably important to understand the current state of the database.</p>
    </section>
  


        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2010&#x2013;2023
<a href="https://www.mybatis.org/">MyBatis.org</a>
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>
