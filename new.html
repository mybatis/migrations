<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0-M19 from src/site/xdoc/new.xml at 10 Aug 2024
 | Rendered using Apache Maven Fluido Skin 2.0.0-M9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0-M19" />
    <meta name="author" content="The MyBatis Team" />
    <title>MyBatis Migrations | Migrate &gt; new – MyBatis Migrations</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-2.0.0-M9.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-2.0.0-M9.min.js"></script>
  </head>
  <body>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"></div>
          <div class="pull-right"><div id="bannerRight"><h1><a href="https://blog.mybatis.org/" class="externalLink"><img class="imageLink" src="../images/mybatis-logo.png" alt="MyBatis logo" /> MyBatis</a></h1></div></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 10 Aug 2024<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 3.4.0</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Migrations</li>
    <li><a href="index.html">Introduction</a></li>
    <li><a href="installation.html">Installation</a></li>
    <li><a href="migrate.html"><span class="icon-chevron-down"></span>The &apos;migrate&apos; Command</a>
     <ul class="nav nav-list">
      <li><a href="init.html">init</a></li>
      <li><a href="bootstrap.html">bootstrap</a></li>
      <li class="active"><a>new</a></li>
      <li><a href="status.html">status</a></li>
      <li><a href="updown.html">up, down</a></li>
      <li><a href="version.html">version</a></li>
      <li><a href="pending.html">pending</a></li>
      <li><a href="redo.html">redo</a></li>
      <li><a href="script.html">script</a></li>
      <li><a href="shortcuts.html">Command Shortcuts</a></li>
      <li><a href="custom-loader.html">Custom MigrationLoader</a></li>
     </ul></li>
    <li><a href="hooks.html">Migration Hooks</a></li>
    <li><a href="runtime-migration.html">Runtime Schema Migration</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">


  
    <section><a id="The_.27new.27_command"></a>
<h1>The 'new' command</h1>
      
<p>Now that you&#x2019;ve initialized your repository and bootstrapped your existing database schema, you&#x2019;re ready to
      start leveraging the power of MyBatis Migrations!</p>

      
<p>MyBatis Migrations are simple SQL script files (*.sql) that live in the <code>scripts</code> directory and
      follow a very strict convention. Since this convention is so important, we don&#x2019;t want to leave it up to humans to
      try to get it right every time... so we let automation do what it does best, and keep things consistent.</p>

      
<p>The <code>new</code> command generates the skeleton of a migration script that you can then simply fill in.
      The command is simply run as follows:</p>

      
<pre class="prettyprint"><code>/home/cbegin/testdb$ migrate new &quot;create blog table&quot;</code></pre>

      
<p>The parameter that the new command takes is a comment describing the migration that you're
        creating. You don&#x2019;t need quotes around it, but it helps keep the command readable.</p>

      
<p>When the command is run, it will create a file named something like the following:</p>

      
<pre class="prettyprint"><code>20090807221754_create_blog_table.sql</code></pre>

      
<p>This format is very important (which is why it&#x2019;s generated). The number at the beginning plays three roles.
      First, it&#x2019;s a <i>practically unique</i> identifier, meaning it&#x2019;s highly unlikely that two people will generate the
      same one at the same time (it&#x2019;s not a big deal to resolve if it does happen). Second, it&#x2019;s a timestamp, indicating
      when the migration was created. Third, it is an ordinal index, formatted in a way that will keep the migrations
      sorted in the order in which they were created. The remainder of the filename is the comment you specified in the
      parameter. Finally, the suffix is .sql, indicating the file type that most editors will recognize.</p>

      
<p>Since version 3.2.1, you can change the default timestamp-based file prefix to number sequence by specifying <code>--idpattern</code> option. Assuming that the prefix of the latest existing script is '002', with the following command:</p>

      
<pre class="prettyprint"><code>/home/cbegin/testdb$ migrate --idpattern=000 new &quot;create blog table&quot;</code></pre>

      
<p>the name of the generated file will be:</p>

      
<pre class="prettyprint"><code>003_create_blog_table.sql</code></pre>

      
<p>Instead of specifying the pattern as a command line argument, you can set it in the configuration file <code>$MIGRATIONS_HOME/migration.properties</code> as follows.</p>

      
<pre class="prettyprint"><code># Example of migration.properties
idpattern=000</code></pre>

      
<p>The contents of the migration script also follows a specific and required pattern.
      Here's the contents of the file we just generated:</p>

      
<pre class="prettyprint"><code>-- // create blog table
-- Migration SQL that makes the change goes here.

-- //@UNDO
-- SQL to undo the change goes here.</code></pre>

      
<p>Notice that your comment once again appears at the top of the file.
      You can add more comments beneath it and throughout the script if you like.</p>

      
<p>The section immediately following that comment is where you would put your DDL commands to create the blog table.</p>

      
<p>Then notice the </p>
<pre class="prettyprint"><code>-- //@UNDO</code></pre> section. This section demarcates the script file sections, splitting
      it into two distinct parts. Only the commands above the undo section will be executed when <i>upgrading</i> a database.
      Everything beneath the undo section will be run when <i>downgrading</i> the database. Both sections are kept in
      the same file for simplicity and clarity. The following is a filled in script:

      
<pre class="prettyprint"><code>-- // create blog table
CREATE TABLE BLOG (
  ID INT,
  NAME VARCHAR(255),
  PRIMARY KEY(ID)
);

-- //@UNDO
DROP TABLE BLOG;</code></pre>

      
<p>Notice that the commands are <b>terminated by a colon</b>. This is also important, and you will receive a
      warning and likely a failure if you don't terminate the SQL statements with a colon.</p>

      
<p>Optionally, you can configure your own template to be consumed by the 'new' command. Configuration requires a
      file named migration.properties (in <code>$MIGRATIONS_HOME</code>). This file will contain the location of your template.</p>

      
<pre class="prettyprint"><code># Example of migration.properties

new_command.template=templates/new_template_migration.sql</code></pre>

      
<p>Alternatively you can manually specify the location of your template as such:</p>

      
<pre class="prettyprint"><code>migrate new --template=&lt;path to template&gt; &quot;your description&quot;</code></pre>

      
<p>If neither of these are used, or valid, the default template shown on the previous page will be used.</p>

      
<p>So how do we run this script? Well, first it&#x2019;s probably important to understand the current state of the database.</p>
    </section>
  


        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>©      2010–2024
<a href="https://www.mybatis.org/">MyBatis.org</a>
</p>
        </div>
      </div>
    </footer>
<script>
  if(anchors) {
    anchors.add();
  }
</script>
  </body>
</html>